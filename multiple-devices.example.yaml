# MikroTik Multi-Device Configuration Example
#
# Workflow:
#   1. Create this file with just device credentials
#   2. Run: ./backup-multiple-devices.js multiple-devices.yaml
#   3. Edit the generated configs (replace UNKNOWN passphrases if any)
#   4. Run: ./apply-multiple-devices.js multiple-devices.yaml
#
# For multiple physically close devices:
#   - Use non-overlapping channels (2.4GHz: 1/6/11, 5GHz: 36/52/149)
#   - Use ./diag/optimize-wifi-channels.js to analyze and suggest optimal channels
#
# 802.11r Fast Roaming (per-SSID):
#   - Enable for mobile devices: roaming: { fastTransition: true }
#   - Disable for stationary devices (Sonos, IoT): omit roaming config
#   - Each SSID can have different roaming settings

# Regulatory domain - applies to all devices in the deployment
country: United States

# Remote syslog configuration - applies to all devices
# Useful for centralized logging of WiFi client connect/disconnect events
# to track client roaming between APs
syslog:
  server: 10.0.0.100      # Syslog server IP (e.g., Gravwell, Elasticsearch, rsyslog)
  port: 514               # Syslog port (default: 514)
  topics:                 # Log topics to send
    - wireless            # WiFi client connect/disconnect events

devices:
  # First Access Point
  - device:
      host: 192.168.88.1
      username: admin
      password: admin
    managementInterfaces:
      - ether1
    disabledInterfaces:
      - ether2
    # WiFi optimization for first AP
    wifi:
      2.4GHz:
        channel: 1        # Non-overlapping channel 1
        txPower: 15       # Adjust based on coverage area
        width: 20mhz      # 20MHz only to avoid interference
      5GHz:
        channel: 36       # Non-overlapping channel 36
        txPower: 18
        width: 20/40/80mhz  # Wider channels for better throughput
    ssids:
      # Primary network with 802.11r for seamless roaming
      - ssid: MyNetwork
        passphrase: secure-password-here
        vlan: 100
        bands:
          - 2.4GHz
          - 5GHz
        roaming:
          fastTransition: true  # 802.11r enabled

      # IoT devices - no 802.11r (stationary devices)
      - ssid: IoT-Devices
        passphrase: iot-password-here
        vlan: 100
        bands:
          - 2.4GHz
        # No roaming config = 802.11r disabled

      # Guest network without roaming
      - ssid: Guest-WiFi
        passphrase: guest-password-here
        vlan: 200
        bands:
          - 2.4GHz
          - 5GHz

  # Second Access Point (same SSIDs, different channels)
  - device:
      host: 192.168.88.2
      username: admin
      password: admin
    managementInterfaces:
      - ether1
    disabledInterfaces:
      - ether2
    # WiFi optimization for second AP - non-overlapping with first AP
    wifi:
      2.4GHz:
        channel: 6        # Non-overlapping channel 6
        txPower: 15
        width: 20mhz      # 20MHz only to avoid interference
      5GHz:
        channel: 52       # Non-overlapping channel 52
        txPower: 18
        width: 20/40/80mhz  # Wider channels for better throughput
    ssids:
      - ssid: MyNetwork
        passphrase: secure-password-here
        vlan: 100
        bands:
          - 2.4GHz
          - 5GHz
        roaming:
          fastTransition: true

      - ssid: IoT-Devices
        passphrase: iot-password-here
        vlan: 100
        bands:
          - 2.4GHz

      - ssid: Guest-WiFi
        passphrase: guest-password-here
        vlan: 200
        bands:
          - 2.4GHz
          - 5GHz

  # Third Access Point (different SSIDs, third channel set)
  - device:
      host: 192.168.88.3
      username: admin
      password: admin
    managementInterfaces:
      - ether1
      - ether2  # This AP uses both ports
    disabledInterfaces: []  # No disabled interfaces
    # IGMP snooping - optimize multicast traffic (Sonos, Chromecast, etc.)
    igmpSnooping: true
    # WiFi optimization for third AP - completes non-overlapping set
    wifi:
      2.4GHz:
        channel: 11       # Non-overlapping channel 11
        txPower: 15
        width: 20mhz      # 20MHz only to avoid interference
      5GHz:
        channel: 149      # Non-overlapping channel 149
        txPower: 18
        width: 20/40/80mhz  # Wider channels for better throughput
    ssids:
      # 5GHz only for high-performance devices
      - ssid: MyNetwork-5G
        passphrase: secure-password-here
        vlan: 100
        bands:
          - 5GHz
        roaming:
          fastTransition: true

      # Corporate network
      - ssid: Corporate
        passphrase: corporate-password
        vlan: 50
        bands:
          - 2.4GHz
          - 5GHz
        roaming:
          fastTransition: true

  # Fourth Access Point (LACP bonded uplink for redundancy)
  # Requires switch support for LACP (802.3ad)
  - device:
      host: 192.168.88.4
      username: admin
      password: admin
    managementInterfaces:
      # LACP bond configuration - combines ether1+ether2 for redundancy
      # IMPORTANT: First interface in the list is used as "primary" for consistent MAC address
      # This ensures DHCP static leases work reliably across reboots
      - bond:
          - ether1    # Primary - bond will use this interface's MAC address
          - ether2
    disabledInterfaces: []
    wifi:
      2.4GHz:
        channel: 1
        txPower: 15
        width: 20mhz
      5GHz:
        channel: 36
        txPower: 18
        width: 20/40/80mhz
    ssids:
      - ssid: MyNetwork
        passphrase: secure-password-here
        vlan: 100
        bands:
          - 2.4GHz
          - 5GHz
        roaming:
          fastTransition: true

# ============================================================================
# CAPsMAN DEPLOYMENT EXAMPLE
# ============================================================================
# Below is an example CAPsMAN deployment with a controller and CAPs.
# CAPsMAN provides coordinated 802.11r/k/v roaming across all access points.
#
# Benefits over standalone mode:
#   - 802.11r: Coordinated fast BSS transition (shared PMK keys)
#   - 802.11k: Neighbor reports (APs tell clients about each other)
#   - 802.11v: Client steering (APs proactively move clients to better APs)
#
# Network requirements:
#   - CAPs need IP connectivity to controller (L2 or L3)
#   - For cross-VLAN: allow UDP 5246-5247 to controller from CAP VLANs
#   - DTLS encryption secures CAP-to-controller traffic
#   - Controller addresses use IP format (FQDNs are resolved automatically)
#
# CAPsMAN VLAN (optional but recommended for wifi-qcom devices):
#   - Dedicated L2 VLAN for CAP↔Controller traffic (solves L3 issues)
#   - Static IPs on each device (no DHCP needed, predictable addressing)
#   - Firewall rules block admin access via CAPsMAN VLAN (security)
#   - Only CAPWAP traffic (UDP 5246-5247) allowed on this VLAN
#
# WAP Locking (lockedDevices):
#   - Lock specific WiFi clients to specific access points
#   - Useful for stationary devices (Sonos, IoT) that roam unnecessarily
#   - Uses access-list rules: ACCEPT on target AP, REJECT on others
#   - Configured per-device, applied on the controller
#   - Optional ssid field to lock to specific SSID only
#
# To use this example, comment out the standalone devices above and
# uncomment the CAPsMAN deployment below.
# ============================================================================

# --- CAPsMAN Example (uncomment to use) ---

# # CAPsMAN management VLAN - dedicated L2 for CAP↔Controller traffic
# # This solves wifi-qcom L3 connectivity issues by ensuring L2 connectivity
# capsmanVlan:
#   vlan: 2525                    # VLAN ID for CAPsMAN traffic
#   network: 10.252.50.0/24       # Network for static IP addressing
#
# # Shared SSID configurations - defined once, distributed to all CAPs
# ssids:
#   - ssid: MyNetwork
#     passphrase: secure-password-here
#     vlan: 100
#     bands:
#       - 2.4GHz
#       - 5GHz
#     roaming:
#       fastTransition: true  # 802.11r - fast BSS transition
#       rrm: true             # 802.11k - neighbor reports
#       wnm: true             # 802.11v - client steering
#       transitionThreshold: -80  # dBm threshold for steering
#
#   - ssid: IoT-Devices
#     passphrase: iot-password-here
#     vlan: 100
#     bands:
#       - 2.4GHz
#     # No roaming - stationary devices
#
#   - ssid: Guest-WiFi
#     passphrase: guest-password-here
#     vlan: 200
#     bands:
#       - 2.4GHz
#       - 5GHz
#
# devices:
#   # CAPsMAN Controller (also acts as an AP)
#   - device:
#       host: indoor-wap-south.example.com
#       username: admin
#       password: admin
#     role: controller
#     # Unified capsman config for controller
#     capsman:
#       certificate: auto              # Auto-generate certificate
#       requirePeerCertificate: false  # Don't require CAP certificates
#       vlan:
#         address: 10.252.50.1         # Static IP on CAPsMAN VLAN
#     managementInterfaces:
#       - ether1
#     disabledInterfaces:
#       - ether2
#     wifi:
#       2.4GHz:
#         channel: 1
#         txPower: 15
#         width: 20mhz
#       5GHz:
#         channel: 36
#         txPower: 18
#         width: 20/40/80mhz
#
#   # CAP 1 - Different channels to avoid interference
#   - device:
#       host: indoor-wap-north.example.com
#       username: admin
#       password: admin
#     role: cap
#     # Unified capsman config for CAP
#     capsman:
#       controllerAddresses:
#         - 10.252.50.1                # Controller's CAPsMAN VLAN IP
#       vlan:
#         address: 10.252.50.2         # Static IP on CAPsMAN VLAN
#     managementInterfaces:
#       - ether1
#     disabledInterfaces:
#       - ether2
#     wifi:
#       2.4GHz:
#         channel: 6      # Different from controller
#       5GHz:
#         channel: 52     # Different from controller
#     # WAP Locking - lock specific clients to this AP
#     # Useful for stationary devices (Sonos, IoT) that shouldn't roam
#     lockedDevices:
#       - hostname: sonos-living-room  # Human-readable name (used in comment)
#         mac: "80:4A:F2:8B:D2:FA"      # Client MAC address
#         ssid: IoT-Devices             # Optional: lock to specific SSID only
#       - hostname: smart-thermostat   # No ssid = lock on ALL SSIDs this AP serves
#         mac: "48:A6:B8:8E:49:2C"
#
#   # CAP 2 - Third set of non-overlapping channels
#   - device:
#       host: outdoor-wap.example.com
#       username: admin
#       password: admin
#     role: cap
#     # Unified capsman config for CAP
#     capsman:
#       controllerAddresses:
#         - 10.252.50.1                # Controller's CAPsMAN VLAN IP
#       vlan:
#         address: 10.252.50.3         # Static IP on CAPsMAN VLAN
#     managementInterfaces:
#       - ether1
#     wifi:
#       2.4GHz:
#         channel: 11     # Complete the 1/6/11 set
#       5GHz:
#         channel: 149    # Different DFS-free channel
